<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>수화통역 연습 | 문장 연습</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0f172a;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
    .card{background:#111827;padding:20px;border-radius:12px;box-shadow:0 0 20px #0006;max-width:800px;width:100%}
    button{padding:10px 20px;margin:6px;border-radius:8px;border:none;font-size:16px;cursor:pointer}
    button.primary{background:#22d3ee;color:#00343c;font-weight:bold}
    .sentence{margin:20px 0;font-size:22px}
    video{width:100%;border-radius:12px;background:#000;display:none}
  </style>
</head>
<body>

  <div id="app" class="card">
    <h2>문장 연습 (자동 음성)</h2>
    <div class="sentence" id="sentence">로딩 중...</div>
    <video id="video" controls></video>
    <div class="controls">
      <button id="btnShuffle">🔀 전체 셔플</button>
      <button id="btnRestart">⏮ 처음부터</button>
      <button id="btnPrev">◀ 이전</button>
      <button id="reSpeakBtn">🔊 다시 듣기</button>
      <button id="revealBtn">정답(영상) 보기</button>
      <button id="btnNext" class="primary">다음 ▶</button>
    </div>
  </div>

<script>
  const CARDS = [
    { k: "아이고, 아뿔싸", ex: "가: 오후에 비가 내린다는데, 우산 챙겼어? 나: 아이고. 깜빡했네.", src: "https://ksldict.korean.go.kr/kslserv/signFile/video/exmp/202411/a3mFRN8ardsnitaQ.mp4" },
    { k: "강아지", ex: "강아지 산책은 하루에 30분에서 1시간이 건강을 위해 필요합니다.", src: "https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4" },
    { k: "뉴욕 전철", ex: "미국 뉴욕의 전철이 홍수로 침수되었습니다.", src: "https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4" }
  ];

  let idx = 0; let selectedVoice = null;
  const sentence = document.getElementById('sentence');
  const video = document.getElementById('video');

  function shuffle(arr){
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function speak(text){
    if (!('speechSynthesis' in window)) return;
    try { speechSynthesis.cancel(); } catch(e){}
    if (!text) return;
    const u = new SpeechSynthesisUtterance(text);
    if (selectedVoice) u.voice = selectedVoice;
    u.lang = (selectedVoice?.lang) || 'ko-KR';
    u.rate = 1; u.pitch = 1;
    speechSynthesis.speak(u);
  }

  function loadVoices(){
    if (!('speechSynthesis' in window)) return;
    const voices = speechSynthesis.getVoices();
    selectedVoice = voices.find(v => /ko|Korean|한국어/i.test((v.lang||'') + ' ' + (v.name||''))) || voices[0] || null;
  }
  if ('speechSynthesis' in window){
    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();
  }

  function updateView(){
    const item = CARDS[idx];
    const text = item.ex || item.k;
    sentence.textContent = text;
    video.pause();
    video.style.display = 'none';
    speak(text);
  }

  // === 버튼 이벤트 ===
  document.getElementById('btnShuffle').addEventListener('click', () => {
    shuffle(CARDS);   // 전체 셔플
    idx = 0;         // 처음부터 시작
    updateView();
  });

  document.getElementById('btnRestart').addEventListener('click', () => {
    idx = 0;         // 처음으로 이동
    updateView();
  });

  document.getElementById('btnPrev').addEventListener('click', () => {
    idx = (idx - 1 + CARDS.length) % CARDS.length; // 이전
    updateView();
  });

  document.getElementById('reSpeakBtn').addEventListener('click', () => {
    const item = CARDS[idx];
    speak(item.ex || item.k);
  });

  document.getElementById('revealBtn').addEventListener('click', () => {
    const item = CARDS[idx];
    if (!item.src) return;
    video.src = item.src;
    video.style.display = 'block';
    video.play().catch(()=>{});
  });

  document.getElementById('btnNext').addEventListener('click', () => {
    idx = (idx + 1) % CARDS.length; // 다음
    updateView();
  });

  // 초기 실행: 첫 로드 시 자동 셔플 + 첫 문장 음성
  shuffle(CARDS);
  idx = 0;
  updateView();
</script>

</body>
</html>
