<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìˆ˜í™”í†µì—­ ì—°ìŠµ | ë¬¸ì¥ ìë™ ìŒì„±</title>
  <style>
    :root { color-scheme: dark; }
    body{
      margin:0; font-family:system-ui,-apple-system,"Noto Sans KR",Segoe UI,Roboto,sans-serif;
      background:#0f172a; color:#e5e7eb;
      min-height:100vh; display:flex; align-items:center; justify-content:center; padding:16px;
    }
    .wrap{width:100%; max-width:800px;}
    .card{background:#0b1220; border:1px solid #1f2937; border-radius:14px; padding:20px; box-shadow:0 10px 30px #0006;}
    h1{margin:0 0 8px; font-size:22px; color:#a5b4fc;}
    .sentence{font-size:22px; margin:18px 0 6px;}
    .hint{font-size:14px; color:#94a3b8; margin:0 0 14px;}
    .controls{display:flex; gap:10px; flex-wrap:wrap}
    button{
      background:#1f2937; color:#e5e7eb; border:1px solid #2b3646;
      padding:12px 18px; border-radius:10px; cursor:pointer; font-size:16px;
    }
    button:hover{ background:#22d3ee; color:#00343c; }
    video{ display:none; width:100%; max-height:60vh; margin-top:14px; border-radius:12px; background:#000; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ë¬¸ì¥ ì—°ìŠµ (ìë™ ìŒì„±)</h1>
      <div class="sentence" id="sentence">ë¡œë”© ì¤‘â€¦</div>
      <p class="hint" id="hint">ë‹¤ìŒ â–¶ ì„ ëˆ„ë¥´ë©´ ê³§ë°”ë¡œ ë‹¤ìŒ ë¬¸ì¥ì„ ì½ì–´ì¤ë‹ˆë‹¤.</p>

      <div class="controls">
        <button id="btnReplay">ğŸ”Š ë‹¤ì‹œ ë“£ê¸°</button>
        <button id="btnReveal">ì •ë‹µ(ì˜ìƒ) ë³´ê¸°</button>
        <button id="btnNext">ë‹¤ìŒ â–¶</button>
      </div>

      <video id="video" playsinline preload="metadata" controls></video>
    </div>
  </div>

  <script>
    // === ë°ì´í„°: { k: â€˜ì˜ë¯¸/í‚¤ì›Œë“œâ€™, ex: â€˜ë¬¸ì¥â€™, src: â€˜ì˜ìƒ URLâ€™ } ===
    const DATA = [
      { k: "ì•„ì´ê³ , ì•„ë¿”ì‹¸", ex: "ê°€: ì˜¤í›„ì— ë¹„ê°€ ë‚´ë¦°ë‹¤ëŠ”ë°, ìš°ì‚° ì±™ê²¼ì–´? ë‚˜: ì•„ì´ê³ . ê¹œë¹¡í–ˆë„¤.", src: "https://ksldict.korean.go.kr/kslserv/signFile/video/exmp/202411/a3mFRN8ardsnitaQ.mp4" },
      { k: "ê°•ì•„ì§€", ex: "ê°•ì•„ì§€ ì‚°ì±…ì€ í•˜ë£¨ì— 30ë¶„ì—ì„œ 1ì‹œê°„ì´ ê±´ê°•ì„ ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.", src: "https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4" },
      { k: "ë‰´ìš• ì „ì² ", ex: "ë¯¸êµ­ ë‰´ìš•ì˜ ì „ì² ì´ í™ìˆ˜ë¡œ ì¹¨ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤.", src: "https://test-videos.co.uk/vids/bigbuckbunny/mp4/h264/360/Big_Buck_Bunny_360_10s_1MB.mp4" }
      // ğŸ‘‰ ì—¬ê¸°ì— ê¸°ì¡´ì— ì“°ì‹œë˜ ëª¨ë“  í•­ëª©ì„ ê·¸ëŒ€ë¡œ ì´ì–´ì„œ ë„£ìœ¼ì„¸ìš”.
    ];

    // === ìƒíƒœ ===
    let order = [];      // ëœë¤ ì¸ë±ìŠ¤ ë°°ì—´
    let idx = 0;         // í˜„ì¬ ìœ„ì¹˜
    let started = false; // ì´ˆê¸°í™” ì™„ë£Œ ì—¬ë¶€
    let selectedVoice = null;

    // === ì—˜ë¦¬ë¨¼íŠ¸ ===
    const $sentence = document.getElementById('sentence');
    const $hint = document.getElementById('hint');
    const $video = document.getElementById('video');
    const $btnReplay = document.getElementById('btnReplay');
    const $btnReveal = document.getElementById('btnReveal');
    const $btnNext = document.getElementById('btnNext');

    // === ìœ í‹¸ ===
    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    function currentItem() {
      return DATA[order[idx]];
    }

    function speak(text) {
      if (!('speechSynthesis' in window) || !text) return;
      try { speechSynthesis.cancel(); } catch (e) {}
      const u = new SpeechSynthesisUtterance(text);
      if (selectedVoice) u.voice = selectedVoice;
      u.lang = (selectedVoice && selectedVoice.lang) || 'ko-KR';
      u.rate = 1; u.pitch = 1;
      speechSynthesis.speak(u);
    }

    function loadVoices() {
      if (!('speechSynthesis' in window)) return;
      const voices = speechSynthesis.getVoices();
      selectedVoice = voices.find(v => /ko|Korean|í•œêµ­ì–´/i.test(v.lang + ' ' + v.name)) || voices[0] || null;
    }

    // ì¼ë¶€ ë¸Œë¼ìš°ì €ëŠ” voices ë¡œë”©ì´ ëŠ¦ì–´ì ¸ onvoiceschangedê°€ í•œì°¸ ë’¤ì— ëœ¹ë‹ˆë‹¤.
    function waitForVoices(timeoutMs = 1200) {
      return new Promise(resolve => {
        const start = Date.now();
        function check() {
          loadVoices();
          if (speechSynthesis.getVoices().length || Date.now() - start > timeoutMs) resolve();
          else setTimeout(check, 100);
        }
        check();
      });
    }

    function renderAndSpeak() {
      const item = currentItem();
      const text = item.ex || item.k;
      $sentence.textContent = text;
      $video.pause();
      $video.style.display = 'none';
      speak(text);
    }

    function initSession() {
      // ì¸ë±ìŠ¤ ëœë¤ ìƒì„±
      order = DATA.map((_, i) => i);
      shuffle(order);
      idx = 0;
      started = true;
      renderAndSpeak();
      $hint.textContent = 'ì •ë‹µ(ì˜ìƒ) ë³´ê¸°ë¥¼ ëˆ„ë¥´ë©´ ìˆ˜ì–´ ì˜ìƒì„ ë³¼ ìˆ˜ ìˆì–´ìš”.';
    }

    // === ì´ë²¤íŠ¸ ===
    $btnReplay.addEventListener('click', () => { if (started) speak((currentItem().ex || currentItem().k)); });

    $btnReveal.addEventListener('click', () => {
      if (!started) return;
      const { src } = currentItem();
      if (!src) return;
      $video.src = src;
      $video.style.display = 'block';
      $video.play().catch(() => {});
    });

    $btnNext.addEventListener('click', () => {
      if (!started) return;
      idx = (idx + 1) % order.length;
      renderAndSpeak();
    });

    // === ì‹œì‘: í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ ë¬¸ì¥ ëª¨ë“œ ì‹œì‘ ===
    (async function boot() {
      if (!DATA.length) {
        $sentence.textContent = 'ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. DATA ë°°ì—´ì„ ì±„ì›Œ ë„£ì–´ ì£¼ì„¸ìš”.';
        return;
      }
      // ìŒì„± ë¡œë”©ì„ ì ê¹ ê¸°ë‹¤ë ¸ë‹¤ê°€ ì„¸ì…˜ ì‹œì‘
      await waitForVoices();
      initSession();
    })();
  </script>
</body>
</html>
